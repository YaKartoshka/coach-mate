<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%=L('comp_cr1', language, 'Competitions') %></title>
    <link rel="shortcut icon" href="../public/images/Favicon.png" type="image/x-icon">
    <%- include('./components/head.ejs.html') %>


</head>

<body>
    <header>
     
        <div class="logo d-flex align-items-center">
                <span class="material-symbols-outlined btn btn-light px-2 py-0 me-3 burger-menu" style="display: none;" onclick="toggleMenu()">
                    menu
                </span>
             
            <a href="/"><img src="/public/images/CoachMate.png" alt=""></a>
        </div>
        <%- include('./components/profile_bar.ejs.html') %>
    </header>
    <main>
        <%- include('./components/nav_bar.ejs.html') %>
            <div class="container text-dark rounded" id="create_competition_form">
                <div class="col">
                    <div class="row">
                        <h2><%=L('comp_cr2', language, 'Create event') %></h2>
                    </div>
                    <p class="text-primary mt-5" style="font-size: 18px;"><%=L('comp_cr3', language, 'Event Info') %></p>
                    <div class="row">
                        <div class="row align-items-baseline gap-5">
                            <div class="col-3">

                                <label class="mb-2 mt-2"><%=L('comp_cr4', language, 'Event name') %></label>
                                <input type="text" id="event_name" class="form-control" placeholder="Championship" />

                                <label class="mb-2 mt-4"><%=L('comp_cr5', language, 'Organizer name') %></label>
                                <input type="text" id="organizer_name" class="form-control" placeholder="Organizer" />

                            </div>
                            <div class="col-6">

                                <label class="mb-2"><%=L('comp_cr6', language, 'Event preview image') %></label>
                                <input type="file" id="event_img" class="form-control file-button w-75" />
                                <label for="event_img" class="mt-2">
                                    <img src="/public/images/choose_image.png" class="selected_image" alt=""
                                        class="w-100">
                                </label>

                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label class="mb-2 mt-2"><%=L('comp_cr7', language, 'Event description') %></label>
                            <textarea name="" id="description" class="form-control" cols="30" rows="10"></textarea>
                        </div>
                    </div>

                    <p class="text-primary mt-5 mb-0" style="font-size: 18px;"><%=L('comp_cr8', language, 'Location') %></p>
                    <div class="row align-items-baseline gap-3">
                        <div class="col-3">
                            <label class="mb-2"><%=L('comp_cr9', language, 'City') %></label>
                            <input type="text" id="city" class="form-control" placeholder="Astana" />
                        </div>
                        <div class="col-6">
                            <label class="mb-2 mt-4"><%=L('comp_cr10', language, 'Address') %></label>
                            <input type="text" id="address" class="form-control" placeholder="Address" />
                        </div>
                    </div>

                    <p class="text-primary mt-5 mb-0" style="font-size: 18px;"><%=L('comp_cr11', language, 'Date Info') %></p>
                    <div class="row">
                        <div class="row align-items-baseline gap-3">
                            <div class="col-3">
                                <label class="mb-2"><%=L('comp_cr12', language, 'Normal Registration') %></label>
                                <input type="date" id="normal_start_date" class="form-control"
                                    placeholder="Start date" />
                            </div>
                            <div class="col-3">
                                <label class="mb-2 mt-4">&nbsp;</label>
                                <input type="date" id="normal_end_date" class="form-control" placeholder="End date" />
                            </div>
                        </div>
                        <div class="row align-items-baseline gap-3">
                            <div class="col-3">
                                <label class="mb-2"><%=L('comp_cr13', language, 'Late Registration') %></label>
                                <input type="date" id="late_start_date" class="form-control" placeholder="Start date" />
                            </div>
                            <div class="col-3">
                                <label class="mb-2 mt-4">&nbsp;</label>
                                <input type="date" id="late_end_date" class="form-control" placeholder="End date" />
                            </div>
                        </div>
                        <div class="row align-items-baseline gap-3">
                            <div class="col-3 mt-4">
                                <label class="mb-2"><%=L('comp_cr14', language, 'Event starts') %></label>
                                <input type="date" id="event_start" class="form-control" placeholder="Astana" />
                            </div>
                            <div class="col-3 mt-4">
                                <label class="mb-2"><%=L('comp_cr15', language, 'Event time') %></label>
                                <input type="time" id="event_time" class="form-control" placeholder="Astana" />
                            </div>
                        </div>
                    </div>

                    <p class="text-primary mt-5 mb-0" style="font-size: 18px;"><%=L('comp_cr16', language, 'Contacts') %></p>
                    <div class="row align-items-baseline gap-3">
                        <div class="col-3">
                            <label class="mb-2"><%=L('comp_cr17', language, '') %></label>
                            <input type="text" id="phone_number" class="form-control" placeholder="+77" />
                        </div>
                        <div class="col-6">
                            <label class="mb-2 mt-4"><%=L('comp_cr18', language, 'Email') %></label>
                            <input type="text" id="email" class="form-control" placeholder="coachmate@gmail.com" />
                        </div>
                    </div>

                    <p class="text-primary mt-5 mb-0" style="font-size: 18px;"><%=L('comp_cr19', language, 'Entries') %></p>
                    <div class="row ">
                        <div class="col">
                            <div id="entries">

                            </div>
                            <button class="btn btn-outline-primary mt-2" onclick="addNewEntry()"> + <%=L('comp_cr20', language, 'New Entry') %></button>

                        </div>
                    </div>
                    <div class="create_competition_form-footer">
                        <button type="button" id="create_competition_btn" class="btn btn-primary px-5 py-2"
                            onclick="createCompetition()"> <%=L('comp_cr21', language, 'Save changes') %></button>
                    </div>
                </div>


            </div>
    </main>
    <footer></footer>

    <script type="text/javascript" src="https://s2.webapi.ai/chat-widget/uniq-chat.js"></script>

    <script>
        var ailabs_user_info = {
            'client': 'c1463',
            'welcome_message': 'Welcome to the chat ðŸ‘‹',
            'popup_mode': 0, //0-off, 1-auto popup after 10 seconds for new users
            'input_comment': 'Type your message or /start to restart'
        };
        AILabsChatStart();
    </script>


    <!-- END OF MODALS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        var globalPasses;
        var globalPassId;
        var globalPassIndex;
        var globalNewEntryIndex = 1;
        $(document).ready(async function () {
            var currentUrl = window.location.pathname;

            $(".nav-bar ul li").each(function () {
                var listItem = $(this);
                var listItemLink = listItem.find("a");
                var listItemHref = listItemLink.attr("href");

                if (currentUrl === listItemHref) {
                    listItem.addClass("active");
                } else {
                    listItem.removeClass("active");
                }
            });
            loading(1);
            loading(0);

        });




        function createCompetition() {
            var competitionData = new FormData();
            loading(2, el = "#create_competition_btn");
            if (!$('#event_img')[0].files[0]) {
                loading(20, el = "#create_competition_btn");
                $('#event_img').focus();
                return $.ambiance({
                    message: "<%=L('comp_cr22', language, 'Upload event image') %>",
                    type: "error",
                    fade: true,
                    width: 400
                });
            }


            var isValid = true;

            $("#create_competition_form input, #create_competition_form textarea").each(function () {
                if ($(this).val().trim() == "") {
                    loading(20, el = "#create_competition_btn");
                    $(this).focus()
                    $.ambiance({
                        message: "<%=L('comp_cr23', language, 'Fill in required fields') %>",
                        type: "error",
                        fade: true,
                        width: 400
                    });
                    isValid = false;
                    return false;
                }
            });

            if (!isValid) return;


            var entriesValid = true;
            $("#entries .row").each(function () {
                var name = $(this).find("input[type='text']").val();
                var from = parseInt($(this).find("input[type='number']").eq(0).val());
                var to = parseInt($(this).find("input[type='number']").eq(1).val());

                if (name && !isNaN(from) && !isNaN(to)) {
                    competitionData.append("entries[]", JSON.stringify({ name: name, from: from, to: to }));
                } else {
                    loading(20, el = "#create_competition_btn");
                    $.ambiance({
                        message: "<%=L('comp_cr23', language, 'Fill in required fields') %>",
                        type: "error",
                        fade: true,
                        width: 400
                    });
                    entriesValid = false;
                    return false;
                }
            });

            if (!entriesValid) return;



            competitionData.append("event_img", $('#event_img')[0].files[0]);
            competitionData.append("event_name", $("#event_name").val().trim());
            competitionData.append("organizer_name", $("#organizer_name").val().trim());
            competitionData.append("description", $("#description").val().trim());
            competitionData.append("city", $("#city").val().trim());
            competitionData.append("address", $("#address").val().trim());
            competitionData.append("normal_start_date", $("#normal_start_date").val().trim());
            competitionData.append("normal_end_date", $("#normal_end_date").val().trim());
            competitionData.append("late_start_date", $("#late_start_date").val().trim());
            competitionData.append("late_end_date", $("#late_end_date").val().trim());
            competitionData.append("event_start", $("#event_start").val().trim());
            competitionData.append("event_time", $("#event_time").val().trim());
            competitionData.append("phone_number", $("#phone_number").val().trim());
            competitionData.append("email", $("#email").val().trim());

            $.ajax({
                url: '/competitions/create',
                method: 'POST',
                processData: false,
                contentType: false,
                data: competitionData,
                success: function (res) {
                    if (res.r) {
                        $.ambiance({
                            message: "<%=L('comp_cr24', language, 'Competition created') %>",
                            type: "success",
                            fade: true,
                            width: 400
                        });
                    } else {
                        $.ambiance({
                            message: "<%=L('comp_cr25', language, 'Something went wrong') %>",
                            type: "error",
                            fade: true,
                            width: 400
                        });
                    }
                    loading(20, el = "#create_competition_btn");
                }
            });
        }


        function addNewEntry() {
            var entryHTML = `
                <div id="entry-${globalNewEntryIndex}" class="row align-items-baseline gap-3">
                    <div class="col-3">
                        <label class="mb-2"><%=L('comp_cr', language, '') %>Name</label>
                        <input type="text" id="entry_name-${globalNewEntryIndex}" class="form-control" placeholder="U7" />
                    </div>
                    <div class="col-3">
                        <label class="mb-2 mt-4"><%=L('comp_cr', language, '') %>From</label>
                        <input type="number" id="entry_from-${globalNewEntryIndex}" class="form-control" placeholder="7" />
                    </div>
                    <div class="col-3">
                        <label class="mb-2 mt-4"><%=L('comp_cr', language, '') %>To</label>
                        <input type="number" id="entry_to-${globalNewEntryIndex}" class="form-control" placeholder="8" />
                    </div>
                    <div class="col-3">

                    </div>    
                </div>
            `
            $('#entries').append(entryHTML);
            globalNewEntryIndex++;
        }

    </script>
</body>

</html>