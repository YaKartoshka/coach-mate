<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitions</title>
    <link rel="shortcut icon" href="../public/images/Favicon.png" type="image/x-icon">
    <%- include('./components/head.ejs.html') %>


</head>

<body>
    <header>
        <div class="logo">
            <a href="/"><img src="/public/images/CoachMate.png" alt=""></a>
        </div>
        <%- include('./components/profile_bar.ejs.html') %>
    </header>
    <main>
        <%- include('./components/nav_bar.ejs.html') %>
            <div class="container create_competition_form text-dark rounded">
                <div class="col">
                    <div class="row">
                        <h2>Create event</h2>
                    </div>
                    <p class="text-primary mt-5" style="font-size: 18px;">Event Info</p>
                    <div class="row">
                        <div class="row align-items-baseline gap-5">
                            <div class="col-3">

                                <label class="mb-2 mt-2">Event name</label>
                                <input type="text" id="event_name" class="form-control" placeholder="Championship" />

                                <label class="mb-2 mt-4">Organizer name</label>
                                <input type="text" id="organizer_name" class="form-control" placeholder="Organizer" />

                            </div>
                            <div class="col-6">

                                <label class="mb-2">Event preview image</label>
                                <input type="file" id="event_image" class="form-control file-button w-75" />
                                <label for="event_image" class="mt-2">
                                    <img src="/public/images/choose_image.png" class="selected_image" alt=""
                                        class="w-100">
                                </label>

                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label class="mb-2 mt-2">Event description</label>
                            <textarea name="" id="description" class="form-control" cols="30" rows="10"></textarea>
                        </div>
                    </div>

                    <p class="text-primary mt-5 mb-0" style="font-size: 18px;">Location</p>
                    <div class="row align-items-baseline gap-3">
                        <div class="col-3">
                            <label class="mb-2">City</label>
                            <input type="text" id="city" class="form-control" placeholder="Astana" />
                        </div>
                        <div class="col-6">
                            <label class="mb-2 mt-4">Address</label>
                            <input type="text" id="address" class="form-control" placeholder="Address" />
                        </div>
                    </div>

                    <p class="text-primary mt-5 mb-0" style="font-size: 18px;">Date Info</p>
                    <div class="row">
                        <div class="row align-items-baseline gap-3">
                            <div class="col-3">
                                <label class="mb-2">Normal Registration</label>
                                <input type="date" id="normal_start_date" class="form-control"
                                    placeholder="Start date" />
                            </div>
                            <div class="col-3">
                                <label class="mb-2 mt-4">&nbsp;</label>
                                <input type="date" id="normal_end_date" class="form-control" placeholder="End date" />
                            </div>
                        </div>
                        <div class="row align-items-baseline gap-3">
                            <div class="col-3">
                                <label class="mb-2">Late Registration</label>
                                <input type="date" id="late_start_date" class="form-control" placeholder="Start date" />
                            </div>
                            <div class="col-3">
                                <label class="mb-2 mt-4">&nbsp;</label>
                                <input type="date" id="late_end_date" class="form-control" placeholder="End date" />
                            </div>
                        </div>
                        <div class="row align-items-baseline gap-5">
                            <div class="col-3 mt-4">
                                <label class="mb-2">Event starts</label>
                                <input type="date" id="event_start" class="form-control" placeholder="Astana" />
                            </div>
                        </div>
                    </div>

                    <p class="text-primary mt-5 mb-0" style="font-size: 18px;">Contacts</p>
                    <div class="row align-items-baseline gap-3">
                        <div class="col-3">
                            <label class="mb-2">Phone Number</label>
                            <input type="text" id="phone_number" class="form-control" placeholder="+77" />
                        </div>
                        <div class="col-6">
                            <label class="mb-2 mt-4">Email</label>
                            <input type="text" id="email" class="form-control" placeholder="coachmate@gmail.com" />
                        </div>
                    </div>
                    <div class="create_competition_form-footer">

                        <button type="button" id="create_competition_btn" class="btn btn-outline-primary px-5 py-2"
                            onclick="createCompetion()"> Save changes</button>
                    </div>
                </div>


            </div>
    </main>
    <footer></footer>

    <!-- MODALS -->


    <div class="modal fade" id="create_link-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Add Link</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3 mt-3">
                            <label class="mb-2">Link text</label>
                            <input type="text" class="form-control" id="link_text" placeholder="Text">
                        </div>
                        <div class="mb-3 mt-3">
                            <label class="mb-2">Link URL</label>
                            <input type="text" class="form-control" id="link_url" placeholder="https://">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="add_link_btn" class="btn btn-primary px-md-4"
                        onclick="createLink()">Add</button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="delete_link-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Delete Link</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    You won't be able to revert this. Are you sure?
                </div>
                <div class="modal-footer">
                    <button type="button" id="delete_link_btn" class="btn btn-danger px-md-4"
                        onclick="deleteLink()">Delete</button>
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://s2.webapi.ai/chat-widget/uniq-chat.js"></script>

    <script>
        var ailabs_user_info = {
            'client': 'c10',
            'welcome_message': 'Welcome to the chat ðŸ‘‹',
            'popup_mode': 0, //0-off, 1-auto popup after 10 seconds for new users
            'input_comment': 'Type your message or /start to restart'
        };
        AILabsChatStart();
    </script>


    <!-- END OF MODALS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        var globalPasses;
        var globalPassId;
        var globalPassIndex;
        $(document).ready(async function () {
            var currentUrl = window.location.pathname;

            $(".nav-bar ul li").each(function () {
                var listItem = $(this);
                var listItemLink = listItem.find("a");
                var listItemHref = listItemLink.attr("href");

                if (currentUrl === listItemHref) {
                    listItem.addClass("active");
                } else {
                    listItem.removeClass("active");
                }
            });
            loading(1);
            showCompetitions();
            loading(0);

        });


        function showCompetitions() {
            $.ajax({
                url: '/events/get',
                method: 'GET',
                success: function (data) {
                    globalEvents = data
                    var i = 0;
                    eventsHTML = '';
                    data.forEach((ed) => {
                        var formattedDate = new Date(ed.event_date).toLocaleString('default', { month: 'long', day: 'numeric' })
                        eventsHTML += `
                            <div class="event" id="event-${i}"> 
                                <div class="date_time"><b>${ed.event_date ? formattedDate : (ed.week_day.charAt(0).toUpperCase() + ed.week_day.slice(1))} ${ed.time}</b></div>
                                <div class="event_name text-center">${ed.event_name}</div>
                                <div class="coach_name">Coach: ${ed.coach_name}</div>
                                <button class="btn btn-primary mx-5 px-5" onclick="showMembersModal('event-${i}')">Members</button>
                                <button type="button" class="btn btn-light dropdown-toggle d-flex" data-bs-toggle="dropdown" style="float:right;">
                                    <div class="more_icon d-flex">
                                    <span class="material-symbols-outlined" style="font-size: 25px; font-weight: 900;">
                                    more_horiz
                                    </span>
                                </div>
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="javascript:void(0)" onclick="showEditEventModal('event-${i}')">Edit</a>
                                    <a class="dropdown-item" href="javascript:void(0)" onclick="showDeleteEventModal('event-${i}')">Delete</a>
                                </div>
                            </div>
                            `
                        i++;
                    });
                    $('.events').html(eventsHTML);
                },
                error: function (e) {
                    console.log(e);
                }
            });
        }

        function createCompetion() {
            var eventData = {
                eventName: $("#event_name").val().trim(),
                organizerName: $("#organizer_name").val().trim(),
                eventImage: $("#event_image").val().trim(),
                eventDescription: $("#description").val().trim(),
                city: $("#city").val().trim(),
                address: $("#address").val().trim(),
                normalStartDate: $("#normal_start_date").val().trim(),
                normalEndDate: $("#normal_end_date").val().trim(),
                lateStartDate: $("#late_start_date").val().trim(),
                lateEndDate: $("#late_end_date").val().trim(),
                eventStart: $("#event_start").val().trim(),
                phoneNumber: $("#phone_number").val().trim(),
                email: $("#email").val().trim()
            };

            // Check for empty values
            for (var key in eventData) {
                if (eventData.hasOwnProperty(key) && eventData[key] === "") {
                    return $.ambiance({
                        message: "Fill in required fields",
                        type: "error",
                        fade: true,
                        width: 400
                    });
                    // Exit the function if any field is empty
                }
            }

        }

    </script>
</body>

</html>