<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <link rel="shortcut icon" href="../public/images/Favicon.png" type="image/x-icon">
    <%- include('./components/head.ejs.html') %>
</head>

<body>
    <header>
        <div class="logo">
            <a href="/"><img src="/public/images/CoachMate.png" alt=""></a>
        </div>
        <%- include('./components/profile_bar.ejs.html') %>
    </header>
    <main>
        <%- include('./components/nav_bar.ejs.html') %>

            <div class="settings-content">
                <div class="tab-switcher">
                    <div class="profile-tab active">PROFILE</div>
                    <div class="password-tab">PASSWORD</div>
                    <div class="billing-tab">BILLING</div>
                </div>


                <div class="tab-content">
                    <div class="profile-content active">


                        <div class="profile_header">
                            <div class="profile-image-settings">
                                <div class="photo">
                                    <img src="" class="rounded-circle" alt="" id="profile_img" width="150">
                                </div>

                                <div class="profile_photo mb-3 mt-2">
                                    <label class="mb-3">
                                        <input type="file" class="form-control file-button" id="profile_photo"
                                            placeholder="Change photo">
                                    </label>
                                </div>
                            </div>

                            <!-- <div class="panel-name mb-3 mt-4">
                                <label class="mb-2">Panel name</label>
                                <input type="text" class="form-control" id="panel_name" placeholder="Your panel name">
                            </div> -->
                        </div>

                        <div class="personal-info">
                            <form autocomplete="off">
                                <div class="mb-3 mt-5">
                                    <p>Personal info</p>
                                </div>

                                <div class="main-info">
                                    <div class="fname-lname">
                                        <div class="fname mb-3 mt-3">
                                            <label class="mb-2">First name</label>
                                            <input type="text" class="form-control" id="first_name" placeholder="Toji">
                                        </div>
                                        <div class="lname mb-3 mt-3">
                                            <label class="mb-2">Last name</label>
                                            <input type="text" class="form-control" id="last_name"
                                                placeholder="Fushiguro">
                                        </div>
                                    </div>
                                    <div class="email-phone">
                                        <div class="email mb-3 mt-3">
                                            <label class="mb-2">Email</label>
                                            <input type="text" class="form-control" id="email"
                                                placeholder="example@gmail.com">
                                        </div>
                                        <div class="phone-number mb-3 mt-3">
                                            <label class="mb-2">Phone number</label>
                                            <input type="text" class="form-control" id="phone_number"
                                                placeholder="+77072585014">
                                        </div>
                                    </div>
                                </div>

                                <div class="about mb-3 mt-4">
                                    <label class="mb-2">About me</label>
                                    <textarea id="about_me_text" cols="30" rows="7" class="form-control"></textarea>
                                </div>
                            </form>
                        </div>


                        <div class="profile-footer">
                            <div class="save-btn">
                                <button type="button" class="btn btn-outline-primary">Save changes</button>
                            </div>

                            <div class="box-important">
                                <img src="../public/images/box Important.svg" alt="">
                                <span>Personalize your profile to provide your colleagues with a deeper understanding of
                                    who you
                                    are. Remember to include a photo as well!</span>
                            </div>
                        </div>
                    </div>
                    <div class="password-content">
                        <div class="password-header">
                            <div class="box-important">
                                <img src="../public/images/password.svg" alt="">
                                <span>Personalize your profile to provide your colleagues with a deeper understanding of
                                    who you are. Remember to include a photo as well!</span>
                            </div>
                        </div>

                        <div class="password-body">
                            <div class="newpass-confirmpass">
                                <div class="new-password mb-3 mt-5">
                                    <label class="mb-2">New password</label>
                                    <input type="password" class="form-control" id="new_password" placeholder="1234567">
                                </div>
                                <div class="confirm-password mb-3 mt-5">
                                    <label class="mb-2">Confirm new password</label>
                                    <input type="password" class="form-control" id="confirm_password"
                                        placeholder="1234567">
                                </div>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="showPasswordCheckbox">
                                <label class="form-check-label show-pass" for="showPasswordCheckbox">Show
                                    password</label>
                            </div>
                        </div>

                        <div class="password-footer">
                            <div class="save-btn">
                                <button type="button" class="btn btn-outline-primary">Save changes</button>
                            </div>
                        </div>
                    </div>
                    <div class="billing-content">
                        <h1>BILLING CONTENT</h1>
                        <p>This is the content for the BILLING tab.</p>
                    </div>

                </div>

            </div>
    </main>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            loading(1);
            showProfile();
            loading(0);
        });

        $('#profile-data').on('click', () => {
            $('.dropdown-content').slideToggle(300);
        });

        $(document).ready(function () {
            var currentUrl = window.location.pathname;

            $(".nav-bar ul li").each(function () {
                var listItem = $(this);
                var listItemLink = listItem.find("a");
                var listItemHref = listItemLink.attr("href");

                if (currentUrl === listItemHref) {
                    listItem.addClass("active");
                } else {
                    listItem.removeClass("active");
                }
            });
        });


        $(document).ready(function () {
            var tabs = $(".tab-switcher > div");
            var tabContents = $(".tab-content > div");

            tabs.each(function (index) {
                $(this).click(function () {

                    tabs.removeClass("active");
                    tabContents.removeClass("active");


                    $(this).addClass("active");
                    tabContents.eq(index).addClass("active");
                });
            });

            tabs.first().click();
        });

        $(document).ready(function () {
            $('#showPasswordCheckbox').change(function () {
                const newPasswordInput = $('#new_password');
                const confirmPasswordInput = $('#confirm_password');

                if ($(this).is(':checked')) {
                    newPasswordInput.attr('type', 'text');
                    confirmPasswordInput.attr('type', 'text');
                } else {
                    newPasswordInput.attr('type', 'password');
                    confirmPasswordInput.attr('type', 'password');
                }
            });
        });

        function showProfile() {

            $.ajax({
                url: '/users/get', method: 'get', success: function (data) {
                    var user = JSON.parse(data);
                    console.log(user);
                    $("#first_name").val(user.first_name);
                    $("#last_name").val(user.last_name);
                    $("#email").val(user.email);
                    
                    let profile_src = !user.profile_img ? "./public/images/user_avatar.png" : user.profile_img;
                    $('#profile_img').attr('src', profile_src)
                }, error: function (err) {
                    console.log(err)
                }
            })
        }
    </script>

</body>

</html>