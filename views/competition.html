<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitions</title>
    <link rel="shortcut icon" href="../public/images/Favicon.png" type="image/x-icon">
    <%- include('./components/head.ejs.html') %>
        <script>
            function loading(mode, el = null) {
                if (mode == 1) {
                    $(el).html('<img src="/public/images/preloader.svg" class="loader_overlay">');
                } else if (mode == 2) {
                    $(el).prepend('<div class="spinner-border"></div> ').attr('disabled', true);
                } else if (mode == 20) {
                    setTimeout(function () {
                        $(el).removeAttr('disabled');
                        $(el).find('.spinner-border').remove();
                    }, 500);
                } else if (mode == 3) {
                    $(el).append(' <div class="spinner-border"></div>');
                } else if (mode == 30) {
                    $(el).find('.spinner-border').remove();
                }
            }
        </script>

</head>

<body>
    <header>
        <div class="logo">
            <a href="/"><img src="/public/images/CoachMate.png" alt=""></a>
        </div>
        <%- include('./components/profile_bar.ejs.html') %>
    </header>
    <main>
        <%- include('./components/nav_bar.ejs.html') %>
            <div class="container competition-content text-dark">
                <div class="col">
                    <div class="row">
                        <h2>Create event</h2>
                    </div>
                    <div class="row">
                        <div class="row ">
                            <div class="col-3">
                                <div class="row">
                                    <label class="mb-2">Event name</label>
                                    <input type="text" id="pass_section" class="form-control" />
                                </div>
                                <div class="row">
                                    <label class="mb-2">Section name</label>
                                    <input type="text" id="pass_section" class="form-control" />
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="row">
                                    <label class="mb-2">Section name</label>
                                    <input type="text" id="pass_section" class="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
    </main>
    <footer></footer>

    <!-- MODALS -->
    <div class="modal fade" id="create_pass-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Add new pass</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form autocomplete="off">
                        <div class="mb-3 mt-3">
                            <label class="mb-2">Section name</label>
                            <input type="text" id="pass_section" class="form-control" />
                        </div>
                        <div class="mb-3 mt-3">
                            <label class="mb-2">Price</label>
                            <input type="text" id="pass_price" class="form-control" />
                        </div>
                        <div class="mb-3 mt-3">
                            <label class="mb-2">Amount of attendance</label>
                            <input type="text" id="pass_attendace" class="form-control" />
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="add_competition_btn" class="btn btn-primary px-md-4"
                        onclick="createCompetition()">Add</button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="create_link-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Add Link</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3 mt-3">
                            <label class="mb-2">Link text</label>
                            <input type="text" class="form-control" id="link_text" placeholder="Text">
                        </div>
                        <div class="mb-3 mt-3">
                            <label class="mb-2">Link URL</label>
                            <input type="text" class="form-control" id="link_url" placeholder="https://">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="add_link_btn" class="btn btn-primary px-md-4"
                        onclick="createLink()">Add</button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="delete_link-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Delete Link</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    You won't be able to revert this. Are you sure?
                </div>
                <div class="modal-footer">
                    <button type="button" id="delete_link_btn" class="btn btn-danger px-md-4"
                        onclick="deleteLink()">Delete</button>
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://s2.webapi.ai/chat-widget/uniq-chat.js"></script>

    <script>
        var ailabs_user_info = {
            'client': 'c10',
            'welcome_message': 'Welcome to the chat ðŸ‘‹',
            'popup_mode': 0, //0-off, 1-auto popup after 10 seconds for new users
            'input_comment': 'Type your message or /start to restart'
        };
        AILabsChatStart();
    </script>


    <!-- END OF MODALS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        var globalPasses;
        var globalPassId;
        var globalPassIndex;
        $(document).ready(async function () {
            var currentUrl = window.location.pathname;

            $(".nav-bar ul li").each(function () {
                var listItem = $(this);
                var listItemLink = listItem.find("a");
                var listItemHref = listItemLink.attr("href");

                if (currentUrl === listItemHref) {
                    listItem.addClass("active");
                } else {
                    listItem.removeClass("active");
                }
            });
            loading(1);
            showCompetitions();
            loading(0);

        });


        function showEvents() {
            $.ajax({
                url: '/events/get',
                method: 'GET',
                success: function (data) {
                    globalEvents = data
                    var i = 0;
                    eventsHTML = '';
                    data.forEach((ed) => {
                        var formattedDate = new Date(ed.event_date).toLocaleString('default', { month: 'long', day: 'numeric' })
                        eventsHTML += `
                            <div class="event" id="event-${i}"> 
                                <div class="date_time"><b>${ed.event_date ? formattedDate : (ed.week_day.charAt(0).toUpperCase() + ed.week_day.slice(1))} ${ed.time}</b></div>
                                <div class="event_name text-center">${ed.event_name}</div>
                                <div class="coach_name">Coach: ${ed.coach_name}</div>
                                <button class="btn btn-primary mx-5 px-5" onclick="showMembersModal('event-${i}')">Members</button>
                                <button type="button" class="btn btn-light dropdown-toggle d-flex" data-bs-toggle="dropdown" style="float:right;">
                                    <div class="more_icon d-flex">
                                    <span class="material-symbols-outlined" style="font-size: 25px; font-weight: 900;">
                                    more_horiz
                                    </span>
                                </div>
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="javascript:void(0)" onclick="showEditEventModal('event-${i}')">Edit</a>
                                    <a class="dropdown-item" href="javascript:void(0)" onclick="showDeleteEventModal('event-${i}')">Delete</a>
                                </div>
                            </div>
                            `
                        i++;
                    });
                    $('.events').html(eventsHTML);
                },
                error: function (e) {
                    console.log(e);
                }
            });
        }

    </script>
</body>

</html>